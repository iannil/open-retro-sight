# 技术架构总览

## 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                         云端/平台层                              │
│                    (MQTT Broker / SCADA)                        │
└─────────────────────────────────────────────────────────────────┘
                              ▲
                              │ MQTT / Modbus TCP
                              │
┌─────────────────────────────────────────────────────────────────┐
│                         输出层                                   │
│              结构化数据(JSON) / 协议转换                          │
└─────────────────────────────────────────────────────────────────┘
                              ▲
                              │
┌─────────────────────────────────────────────────────────────────┐
│                         识别层                                   │
│     PaddleOCR(数字) / YOLOv8-Nano(指针) / 颜色检测(指示灯)        │
└─────────────────────────────────────────────────────────────────┘
                              ▲
                              │
┌─────────────────────────────────────────────────────────────────┐
│                         预处理层                                 │
│         透视变换 / 图像配准 / 区域裁剪 / 数据平滑                  │
└─────────────────────────────────────────────────────────────────┘
                              ▲
                              │
┌─────────────────────────────────────────────────────────────────┐
│                         采集层                                   │
│              OpenCV (视频流处理/去抖动/自动白平衡)                 │
└─────────────────────────────────────────────────────────────────┘
                              ▲
                              │
┌─────────────────────────────────────────────────────────────────┐
│                         硬件层                                   │
│       摄像头 + 计算单元 (树莓派/手机/ESP32-CAM)                    │
└─────────────────────────────────────────────────────────────────┘
```

## 数据流

```
图像采集 → 预处理 → 区域裁剪 → AI识别 → 数据平滑 → 协议输出 → 云端/SCADA
```

## 层次说明

### 1. 硬件层
负责图像采集和边缘计算。
- [硬件层详解](hardware-layer.md)

### 2. 采集层
基于 OpenCV 实现视频流处理：
- 视频流获取
- 去抖动处理
- 自动白平衡

### 3. 预处理层
图像预处理，确保识别精度：
- **透视变换**：支持摄像头侧拍，自动"拉正"图像
- **图像配准**：应对设备振动，基于特征点对齐
- **区域裁剪**：提取用户标注的识别区域
- **数据平滑**：卡尔曼滤波/滑动平均，过滤异常值

### 4. 识别层
核心AI算法：
- **数字识别**：PaddleOCR / Tesseract
- **指针识别**：YOLOv8-Nano + Hough变换
- **指示灯识别**：颜色空间分析
- [核心算法详解](algorithms.md)

### 5. 输出层
数据格式化与协议转换：
- **MQTT**：发往云端平台
- **Modbus TCP Server**：伪装成PLC，供SCADA系统抓取
- [软件技术栈详解](software-stack.md)

## 配置界面

基于 Streamlit 或 Vue 的 Web UI，实现"所见即所得"的配置体验：
- 实时预览摄像头画面
- 鼠标框选识别区域
- 参数配置与校准

## 边缘计算特性

- **本地处理**：数据在边缘设备处理，仅上传结构化JSON
- **断网续传**：网络中断时数据暂存本地，重连后补发
- **低带宽**：极大节省网络带宽消耗

## 相关文档

- [硬件层详解](hardware-layer.md)
- [软件技术栈](software-stack.md)
- [核心算法](algorithms.md)
