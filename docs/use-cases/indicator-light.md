# 状态指示灯识别

## 场景描述

识别产线机台顶部的 Andon 灯（三色灯），判断设备运行状态，用于计算 OEE（设备综合效率）。

## 适用设备

- 产线机台顶部三色灯
- 设备状态指示灯
- 报警灯
- 信号塔灯

## 状态类型

| 灯色 | 状态 | 含义 |
|-----|------|------|
| 绿色 | 运行 | 设备正常运行中 |
| 黄色 | 待机 | 设备待机/暂停/换料 |
| 红色 | 故障 | 设备故障/停机 |
| 熄灭 | 关机 | 设备未启动 |

## 技术实现

### 核心算法

#### 颜色空间分析
- **HSV 颜色空间**：比 RGB 更适合颜色检测
- **颜色阈值**：设定红/黄/绿的 HSV 范围
- **亮度检测**：判断灯是否点亮

### 处理流程
1. **区域裁剪**：提取指示灯区域
2. **颜色空间转换**：RGB → HSV
3. **颜色检测**：判断主导颜色
4. **亮度判断**：区分点亮与熄灭
5. **状态输出**：映射为状态码

## 配置步骤

1. **对准摄像头**：将摄像头对准指示灯
2. **框选区域**：在 Web 界面框选指示灯区域
3. **设置参数**：
   - 类型：指示灯
   - 灯数：单灯/三灯
4. **颜色校准**（可选）：
   - 分别让灯亮红/黄/绿，记录颜色
5. **测试验证**：观察状态识别结果

## OEE 计算应用

### 什么是 OEE
OEE（Overall Equipment Effectiveness，设备综合效率）= 可用率 × 性能率 × 良品率

### 数据采集
通过指示灯识别，自动记录：
- **运行时间**：绿灯时长
- **待机时间**：黄灯时长
- **故障时间**：红灯时长

### 计算公式
```
可用率 = 运行时间 / (运行时间 + 故障时间 + 待机时间)
```

## 技术难点

### 环境光干扰
**问题**：阳光或灯光干扰颜色判断

**解决方案**：
- 自适应阈值
- 相对亮度比较
- 遮光罩辅助

### 闪烁灯
**问题**：某些状态灯会闪烁

**解决方案**：
- 多帧采样
- 占空比检测
- 时序分析

### 多灯塔
**问题**：多层信号塔，需识别每层状态

**解决方案**：
- 多区域检测
- 垂直分割

## 最佳实践

1. 摄像头避免正对光源
2. 保持稳定的环境光线
3. 指示灯清洁，无遮挡
4. 定期校准颜色阈值

## 输出数据

```json
{
  "device_id": "machine_001",
  "status": "running",
  "color": "green",
  "timestamp": "2024-01-15T10:30:00Z",
  "duration_seconds": 3600
}
```

## 相关文档

- [核心算法详解](../architecture/algorithms.md)
- [技术挑战与对策](../roadmap/challenges.md)
