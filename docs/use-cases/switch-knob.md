# 开关/旋钮位置识别

## 场景描述

识别老式配电柜、控制台上的物理开关和旋钮的档位状态。

## 适用设备

- 老式配电柜
- 控制台面板
- 机床操作面板
- 档位选择器
- 模式切换开关

## 识别类型

### 拨动开关
| 位置 | 状态 |
|-----|------|
| 上 | ON / 开启 |
| 中 | 中位 |
| 下 | OFF / 关闭 |

### 旋钮开关
| 位置 | 状态 |
|-----|------|
| 左 | 手动模式 |
| 中 | 关闭 |
| 右 | 自动模式 |

### 多档位旋钮
| 档位 | 状态 |
|-----|------|
| 1 | 低速 |
| 2 | 中速 |
| 3 | 高速 |

## 技术实现

### 核心算法

#### 1. 开关定位
- **模板匹配**：识别开关位置
- **边缘检测**：确定开关边界

#### 2. 位置判断
- **几何分析**：计算开关手柄角度/位置
- **特征点匹配**：与校准模板对比

#### 3. 状态映射
- 根据位置判断当前档位
- 输出状态码

### 处理流程
1. **区域裁剪**：提取开关区域
2. **灰度处理**：简化图像
3. **边缘检测**：Canny 算法
4. **特征提取**：提取开关手柄特征
5. **位置判断**：计算相对位置
6. **状态输出**：映射为档位

## 配置步骤

1. **对准摄像头**：将摄像头对准开关/旋钮
2. **框选区域**：在 Web 界面框选开关区域
3. **设置参数**：
   - 类型：开关/旋钮
   - 档位数：2/3/多档
4. **档位校准**：
   - 将开关拨到各个档位
   - 依次记录每个档位的状态
5. **测试验证**：切换开关，观察识别结果

## 技术难点

### 外观多样
**问题**：开关/旋钮形状各异

**解决方案**：
- 用户自定义校准
- 多模板匹配
- 边缘特征提取

### 遮挡与污渍
**问题**：开关被手或污渍遮挡

**解决方案**：
- 多帧融合
- 历史状态参考
- 报警提示

### 光线影响
**问题**：反光或阴影影响判断

**解决方案**：
- 自适应阈值
- 补光灯辅助

## 最佳实践

1. 摄像头正对开关面板
2. 保持稳定光线
3. 开关表面保持清洁
4. 每个档位都进行校准

## 输出数据

```json
{
  "device_id": "panel_001",
  "switch_id": "mode_selector",
  "position": "auto",
  "position_code": 2,
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## 应用场景

### 模式监控
- 监控设备运行模式（手动/自动）
- 记录模式切换历史

### 安全审计
- 记录关键开关状态变化
- 异常操作报警

### 状态同步
- 将物理开关状态同步到数字系统
- 实现远程监控

## 相关文档

- [核心算法详解](../architecture/algorithms.md)
- [技术挑战与对策](../roadmap/challenges.md)
