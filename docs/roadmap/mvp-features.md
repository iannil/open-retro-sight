# MVP 核心功能

> **状态：✅ 全部完成** (2025-01-19)

## 概述

MVP（Minimum Viable Product，最小可行产品）版本聚焦于核心功能，快速验证产品价值。

## 功能清单

### 1. "所见即所得"的配置交互（亮点功能）

**目标**：用户不需要写代码，通过 Web 界面完成所有配置。

#### 实时预览
- 打开 Web 界面，看到摄像头的实时画面
- 流畅的视频流，低延迟

#### 画框选区
- 用鼠标在画面上框选目标区域
- 示例："这是压力表A"、"这是温度示数B"
- 支持多个选区

#### 参数定义
- 弹窗设置参数
- 类型选择：指针 / 数字 / 指示灯 / 开关
- 量程设置：如 0-10 MPa
- 单位设置：如 MPa、°C

#### 校准功能
- 对于指针表：点击"0刻度"和"满刻度"位置即可完成标定
- 对于数字屏：无需校准，自动识别
- 支持重新校准

### 2. 智能抗干扰机制

#### 去反光
- 多帧融合算法
- 简单的图像算法滤除屏幕反光干扰
- 自动曝光调整

#### 数据平滑
- **问题**：OCR 识别可能会跳动（如 8 识别成 3）
- **方案**：
  - 卡尔曼滤波
  - 滑动平均算法
  - 过滤掉突变的异常值
- **效果**：保证输出曲线平滑

### 3. 边缘计算与断网续传

#### 本地处理
- 数据在本地设备处理
- 仅上传结构化数据（JSON）
- 极大节省带宽

#### 断网续传
- 网络中断时，数据暂存本地
- 重连后自动补发
- 保证数据完整性

## 用户界面设计

### Web 配置界面
```
┌─────────────────────────────────────────────────────────┐
│  Open-RetroSight 配置界面                    [保存] [导出] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────┐  ┌───────────────────────┐ │
│  │                         │  │ 识别区域列表          │ │
│  │    实时摄像头画面        │  │ ┌─────────────────┐  │ │
│  │                         │  │ │ 温度计 [数字]    │  │ │
│  │    [框选的识别区域]      │  │ │ 180.5 °C       │  │ │
│  │                         │  │ └─────────────────┘  │ │
│  │                         │  │ ┌─────────────────┐  │ │
│  │                         │  │ │ 压力表 [指针]    │  │ │
│  │                         │  │ │ 2.5 MPa        │  │ │
│  └─────────────────────────┘  │ └─────────────────┘  │ │
│                               └───────────────────────┘ │
│  [+ 添加识别区域]  [测试连接]  [开始采集]                  │
└─────────────────────────────────────────────────────────┘
```

### 配置流程
```
打开界面 → 查看实时画面 → 框选区域 → 设置参数 → 校准 → 测试 → 保存 → 开始采集
```

## 数据输出

### JSON 格式
```json
{
  "device_id": "gateway_001",
  "timestamp": "2024-01-15T10:30:00.123Z",
  "readings": [
    {
      "id": "temp_01",
      "name": "温度计",
      "type": "digital",
      "value": 180.5,
      "unit": "°C",
      "confidence": 0.98
    },
    {
      "id": "pressure_01",
      "name": "压力表",
      "type": "analog",
      "value": 2.5,
      "unit": "MPa",
      "confidence": 0.95
    }
  ]
}
```

### 输出通道
- **MQTT**：发送到云端平台
- **Modbus TCP**：供 SCADA 系统抓取
- **本地文件**：CSV/JSON 日志

## 性能指标

| 指标 | 目标值 |
|-----|--------|
| 识别延迟 | < 500ms |
| 准确率（数字） | > 99% |
| 准确率（指针） | > 95% |
| 内存占用 | < 512MB |
| CPU 占用 | < 50% |

## 开发优先级

### P0（必须）✅ 全部完成
- [x] 摄像头视频流获取 → `capture/camera.py`
- [x] Web 界面框选区域 → `ui/app.py`
- [x] 数字 OCR 识别 → `recognition/ocr.py`
- [x] MQTT 数据输出 → `output/mqtt.py`
- [x] 基础数据平滑 → `preprocessing/filter.py`

### P1（重要）✅ 全部完成
- [x] 指针识别算法 → `recognition/pointer.py`
- [x] 透视变换校正 → `preprocessing/transform.py`
- [x] Modbus TCP 输出 → `output/modbus.py`
- [x] 断网续传 → `output/buffer.py`

### P2（优化）✅ 全部完成
- [x] 指示灯识别 → `recognition/light.py`
- [x] 开关位置识别 → `recognition/switch.py`
- [x] 多帧融合去反光 → `preprocessing/enhancement.py`
- [x] 高级数据平滑 → `preprocessing/filter.py` (CompositeFilter)

## 相关文档

- [产品愿景](vision.md)
- [技术挑战](challenges.md)
- [架构总览](../architecture/overview.md)
